name: Build and Release
on:
  push:
    tags:
      - 'v*'
jobs:
  build:
    name: Build and Release
    runs-on: windows-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install AutoHotkey
        run: choco install autohotkey -y
      - name: Compile LangConvert
        shell: powershell
        run: |
          # Find Ahk2Exe automatically
          $compilerPath = Get-ChildItem -Path "C:\Program Files" -Filter "Ahk2Exe.exe" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1 -ExpandProperty FullName
          
          if (-not $compilerPath) {
              Write-Error "Could not find Ahk2Exe.exe anywhere in C:\Program Files"
              exit 1
          }
          
          Write-Host "Compiler found at: $compilerPath"
          
          # Compile Main App
          & $compilerPath /in "langover.ahk" /out "langover.exe" /icon "FinalGreen.ico" /base "Unicode 64-bit"
          
          # Compile Setup
          & $compilerPath /in "Setup.ahk" /out "Setup.exe" /icon "FinalGreen.ico" /base "Unicode 64-bit"
      - name: Create Zip Archive
        run: |
          Compress-Archive -Path "Setup.exe", "langover.exe", "DiscountLogo.png", "FinalGreen.ico", "FinalRed.ico", "README.md" -DestinationPath "LangConvert_Install.zip"
      - name: Create Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            LangConvert_Install.zip
            Setup.exe
            langover.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
